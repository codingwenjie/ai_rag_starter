# Day 6ï¼šå‘é‡æ•°æ®åº“å…¥é—¨ï¼ˆEmbedding + å­˜å‚¨ï¼‰

## ğŸ“š å­¦ä¹ ç›®æ ‡

æŒæ¡æ–‡æœ¬å‘é‡åŒ–ã€å­˜å‚¨ä¸æœç´¢çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œä¸ºæ„å»ºRAGç³»ç»Ÿæ‰“ä¸‹åŸºç¡€ã€‚

## ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹

### 1. ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®åº“ï¼Ÿ

å‘é‡æ•°æ®åº“æ˜¯ä¸“é—¨ç”¨äºå­˜å‚¨å’Œæ£€ç´¢é«˜ç»´å‘é‡æ•°æ®çš„æ•°æ®åº“ç³»ç»Ÿã€‚åœ¨AIåº”ç”¨ä¸­ï¼Œæ–‡æœ¬ã€å›¾åƒç­‰éç»“æ„åŒ–æ•°æ®é€šè¿‡embeddingæ¨¡å‹è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼Œç„¶åå­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ä¸­è¿›è¡Œç›¸ä¼¼åº¦æœç´¢ã€‚

**ç®€å•ç†è§£ï¼š**
æƒ³è±¡ä¸€ä¸‹ï¼Œä¼ ç»Ÿæ•°æ®åº“å­˜å‚¨çš„æ˜¯æ–‡å­—ã€æ•°å­—ç­‰ç»“æ„åŒ–æ•°æ®ï¼Œè€Œå‘é‡æ•°æ®åº“å­˜å‚¨çš„æ˜¯ä¸€ä¸²æ•°å­—ï¼ˆå‘é‡ï¼‰ï¼Œè¿™äº›æ•°å­—ä»£è¡¨äº†æ–‡æœ¬çš„"è¯­ä¹‰ç‰¹å¾"ã€‚æ¯”å¦‚ï¼š
- "è‹¹æœå¾ˆç”œ" â†’ [0.2, -0.1, 0.8, ...] ï¼ˆ1536ç»´å‘é‡ï¼‰
- "æ°´æœå‘³é“å¥½" â†’ [0.3, -0.2, 0.7, ...] ï¼ˆç›¸ä¼¼çš„å‘é‡ï¼‰

**æ ¸å¿ƒæ¦‚å¿µè¯¦è§£ï¼š**

#### Embeddingï¼ˆåµŒå…¥ï¼‰
- **å®šä¹‰**ï¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å€¼å‘é‡çš„è¿‡ç¨‹
- **ä¸¾ä¾‹**ï¼š"ä»Šå¤©å¤©æ°”å¾ˆå¥½" â†’ [0.1, 0.3, -0.2, 0.8, ...]
- **ç‰¹ç‚¹**ï¼šè¯­ä¹‰ç›¸è¿‘çš„æ–‡æœ¬ï¼Œå…¶å‘é‡åœ¨é«˜ç»´ç©ºé—´ä¸­è·ç¦»è¾ƒè¿‘
- **ç»´åº¦**ï¼šOpenAIçš„embeddingæ¨¡å‹é€šå¸¸è¾“å‡º1536ç»´å‘é‡

#### ç›¸ä¼¼åº¦æœç´¢
- **å®šä¹‰**ï¼šåŸºäºå‘é‡è·ç¦»æ‰¾åˆ°æœ€ç›¸å…³çš„å†…å®¹
- **å¸¸ç”¨ç®—æ³•**ï¼š
  - ä½™å¼¦ç›¸ä¼¼åº¦ï¼šè®¡ç®—ä¸¤ä¸ªå‘é‡å¤¹è§’çš„ä½™å¼¦å€¼
  - æ¬§å‡ é‡Œå¾—è·ç¦»ï¼šè®¡ç®—ä¸¤ç‚¹é—´çš„ç›´çº¿è·ç¦»
  - ç‚¹ç§¯ï¼šå‘é‡å†…ç§¯è¿ç®—
- **å®é™…åº”ç”¨**ï¼šå½“ç”¨æˆ·é—®"å¤©æ°”æ€ä¹ˆæ ·"æ—¶ï¼Œç³»ç»Ÿä¼šæ‰¾åˆ°ä¸æ­¤æœ€ç›¸ä¼¼çš„å·²å­˜å‚¨æ–‡æ¡£

#### Top-Kæ£€ç´¢
- **å®šä¹‰**ï¼šè¿”å›ç›¸ä¼¼åº¦æœ€é«˜çš„Kä¸ªç»“æœ
- **ä¸¾ä¾‹**ï¼šç”¨æˆ·æŸ¥è¯¢è¿”å›æœ€ç›¸å…³çš„5ä¸ªæ–‡æ¡£ç‰‡æ®µ
- **å‚æ•°è°ƒä¼˜**ï¼šKå€¼å¤ªå°å¯èƒ½é—æ¼ä¿¡æ¯ï¼Œå¤ªå¤§å¯èƒ½å¼•å…¥å™ªéŸ³

### 2. OpenAI Embedding API è¯¦è§£

#### æ¨¡å‹é€‰æ‹©å¯¹æ¯”

| æ¨¡å‹ | ç»´åº¦ | ä»·æ ¼ | æ€§èƒ½ | æ¨èåœºæ™¯ |
|------|------|------|------|----------|
| `text-embedding-ada-002` | 1536 | ä¸­ç­‰ | è‰¯å¥½ | é€šç”¨åœºæ™¯ï¼Œç¨³å®šå¯é  |
| `text-embedding-3-small` | 1536 | è¾ƒä½ | è‰¯å¥½ | æˆæœ¬æ•æ„Ÿçš„é¡¹ç›® |
| `text-embedding-3-large` | 3072 | è¾ƒé«˜ | æœ€ä½³ | å¯¹ç²¾åº¦è¦æ±‚é«˜çš„åœºæ™¯ |

#### å®é™…ä½¿ç”¨ç¤ºä¾‹

```python
# åŸºç¡€è°ƒç”¨ç¤ºä¾‹
import openai

def get_embedding(text, model="text-embedding-3-small"):
    """è·å–æ–‡æœ¬çš„å‘é‡è¡¨ç¤º"""
    response = openai.Embedding.create(
        input=text,
        model=model
    )
    return response['data'][0]['embedding']

# ä½¿ç”¨ç¤ºä¾‹
text = "ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œé€‚åˆå‡ºé—¨æ•£æ­¥"
vector = get_embedding(text)
print(f"å‘é‡ç»´åº¦: {len(vector)}")  # è¾“å‡º: 1536
print(f"å‰5ä¸ªæ•°å€¼: {vector[:5]}")   # è¾“å‡º: [0.1, -0.2, 0.3, ...]
```

#### ä½¿ç”¨åœºæ™¯è¯¦è§£

**1. æ–‡æ¡£ç›¸ä¼¼åº¦æœç´¢**
- åœºæ™¯ï¼šåœ¨å¤§é‡æ–‡æ¡£ä¸­æ‰¾åˆ°ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„å†…å®¹
- å®ç°ï¼šå°†æ‰€æœ‰æ–‡æ¡£å‘é‡åŒ–å­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶è®¡ç®—ç›¸ä¼¼åº¦

**2. è¯­ä¹‰æ£€ç´¢**
- åœºæ™¯ï¼šç”¨æˆ·ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œç³»ç»Ÿç†è§£è¯­ä¹‰è¿”å›ç»“æœ
- ä¼˜åŠ¿ï¼šä¸ä¾èµ–å…³é”®è¯åŒ¹é…ï¼Œç†è§£è¯­ä¹‰å«ä¹‰

**3. æ¨èç³»ç»Ÿ**
- åœºæ™¯ï¼šåŸºäºç”¨æˆ·å†å²è¡Œä¸ºæ¨èç›¸ä¼¼å†…å®¹
- å®ç°ï¼šç”¨æˆ·åå¥½å‘é‡åŒ–ï¼Œæ¨èç›¸ä¼¼å‘é‡çš„å†…å®¹

**4. èšç±»åˆ†æ**
- åœºæ™¯ï¼šå°†ç›¸ä¼¼æ–‡æ¡£è‡ªåŠ¨åˆ†ç»„
- åº”ç”¨ï¼šæ–°é—»åˆ†ç±»ã€å®¢æˆ·åé¦ˆåˆ†æç­‰

### 3. å‘é‡æ•°æ®åº“é€‰å‹å¯¹æ¯”

| æ•°æ®åº“ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | ä¼˜ç¼ºç‚¹ |
|--------|------|----------|--------|
| **FAISS** | Facebookå¼€æºï¼Œçº¯å†…å­˜ | åŸå‹å¼€å‘ã€å°è§„æ¨¡åº”ç”¨ | âœ…å¿«é€Ÿ âŒä¸æŒä¹…åŒ– |
| **ChromaDB** | è½»é‡çº§ï¼Œæ˜“éƒ¨ç½² | ä¸­å°å‹é¡¹ç›® | âœ…ç®€å•æ˜“ç”¨ âŒæ‰©å±•æ€§æœ‰é™ |
| **Weaviate** | äº‘åŸç”Ÿï¼ŒGraphQL API | ä¼ä¸šçº§åº”ç”¨ | âœ…åŠŸèƒ½ä¸°å¯Œ âŒå¤æ‚åº¦é«˜ |
| **Milvus** | é«˜æ€§èƒ½ï¼Œåˆ†å¸ƒå¼ | å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ | âœ…é«˜æ€§èƒ½ âŒè¿ç»´å¤æ‚ |

## ğŸ› ï¸ å®è·µç¯èŠ‚

### ç¯å¢ƒå‡†å¤‡

#### æŠ€æœ¯æ ˆä»‹ç»

| ç»„ä»¶ | ä½œç”¨ | ä¸ºä»€ä¹ˆé€‰æ‹© |
|------|------|------------|
| **LangChain** | AIåº”ç”¨å¼€å‘æ¡†æ¶ | æä¾›ä¸°å¯Œçš„ç»„ä»¶ï¼Œç®€åŒ–å¼€å‘æµç¨‹ |
| **FAISS** | å‘é‡å­˜å‚¨å’Œæ£€ç´¢ | Facebookå¼€æºï¼Œæ€§èƒ½ä¼˜ç§€ï¼Œæ˜“äºä½¿ç”¨ |
| **OpenAI Embedding** | æ–‡æœ¬å‘é‡åŒ– | ä¸šç•Œé¢†å…ˆçš„embeddingæ¨¡å‹ |
| **FastAPI** | WebæœåŠ¡æ¡†æ¶ | ç°ä»£åŒ–APIæ¡†æ¶ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ |

#### å¼€å‘ç¯å¢ƒæ£€æŸ¥

```bash
# 1. æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆéœ€è¦3.8+ï¼‰
python --version

# 2. æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
which python  # ç¡®ä¿åœ¨é¡¹ç›®è™šæ‹Ÿç¯å¢ƒä¸­

# 3. æ£€æŸ¥OpenAI API Key
echo $OPENAI_API_KEY  # ç¡®ä¿å·²è®¾ç½®ç¯å¢ƒå˜é‡
```

### å®æˆ˜é¡¹ç›®ï¼šæ„å»ºç®€å•é—®ç­”ç³»ç»Ÿ

#### ç³»ç»Ÿæ¶æ„è¯¦è§£

```
ğŸ“ æ–‡æ¡£å‡†å¤‡ â†’ ğŸ”¢ å‘é‡åŒ– â†’ ğŸ’¾ å­˜å‚¨åˆ°FAISS
                                    â†“
â“ ç”¨æˆ·é—®é¢˜ â†’ ğŸ”¢ é—®é¢˜å‘é‡åŒ– â†’ ğŸ” ç›¸ä¼¼åº¦æœç´¢
                                    â†“
ğŸ“„ æ£€ç´¢ç›¸å…³æ–‡æ¡£ â†’ ğŸ¤– LLMç”Ÿæˆç­”æ¡ˆ â†’ ğŸ“¤ è¿”å›ç»“æœ
```

#### æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

**1. æ–‡æ¡£å‘é‡åŒ–å­˜å‚¨**
- è¾“å…¥ï¼šåŸå§‹æ–‡æ¡£ï¼ˆtxtã€pdfã€markdownç­‰ï¼‰
- å¤„ç†ï¼šæ–‡æ¡£åˆ†å— â†’ å‘é‡åŒ– â†’ å­˜å‚¨ç´¢å¼•
- è¾“å‡ºï¼šå¯æœç´¢çš„å‘é‡æ•°æ®åº“

**2. é—®é¢˜è¯­ä¹‰æ£€ç´¢**
- è¾“å…¥ï¼šç”¨æˆ·è‡ªç„¶è¯­è¨€é—®é¢˜
- å¤„ç†ï¼šé—®é¢˜å‘é‡åŒ– â†’ ç›¸ä¼¼åº¦è®¡ç®— â†’ Top-Kæ£€ç´¢
- è¾“å‡ºï¼šæœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µ

**3. åŸºäºæ£€ç´¢ç»“æœçš„é—®ç­”ç”Ÿæˆ**
- è¾“å…¥ï¼šç”¨æˆ·é—®é¢˜ + æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£
- å¤„ç†ï¼šæ„å»ºprompt â†’ è°ƒç”¨LLM â†’ ç”Ÿæˆç­”æ¡ˆ
- è¾“å‡ºï¼šåŸºäºæ–‡æ¡£å†…å®¹çš„å‡†ç¡®ç­”æ¡ˆ

#### é¡¹ç›®æ–‡ä»¶ç»“æ„

```
ai_rag_starter/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ embedding_service.py      # å‘é‡åŒ–æœåŠ¡
â”‚   â”œâ”€â”€ vector_store_service.py    # å‘é‡å­˜å‚¨æœåŠ¡
â”‚   â””â”€â”€ qa_system.py              # é—®ç­”ç³»ç»Ÿ
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ day6_demo.py              # å®Œæ•´æ¼”ç¤º
â”‚   â””â”€â”€ day6_simple_example.py    # ç®€å•ç¤ºä¾‹
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_day6_vector_db.py    # æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ data/
    â””â”€â”€ vector_index/             # å‘é‡ç´¢å¼•å­˜å‚¨
```

## ğŸ“ è¯¦ç»†å­¦ä¹ æ­¥éª¤

### Step 1: å®‰è£…ä¾èµ–åŒ…

#### 1.1 åŸºç¡€ä¾èµ–å®‰è£…
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/ai_rag_starter

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # macOS/Linux
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…å‘é‡æ•°æ®åº“ç›¸å…³åŒ…
pip install faiss-cpu chromadb

# éªŒè¯å®‰è£…
python -c "import faiss; print('FAISSå®‰è£…æˆåŠŸ')"
python -c "import chromadb; print('ChromaDBå®‰è£…æˆåŠŸ')"
```

#### 1.2 ä¾èµ–åŒ…è¯´æ˜
- `faiss-cpu`ï¼šCPUç‰ˆæœ¬çš„FAISSï¼Œé€‚åˆå¼€å‘å’Œå°è§„æ¨¡åº”ç”¨
- `faiss-gpu`ï¼šGPUç‰ˆæœ¬ï¼Œé€‚åˆå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦CUDAï¼‰
- `chromadb`ï¼šè½»é‡çº§å‘é‡æ•°æ®åº“ï¼Œå¯é€‰ä½¿ç”¨

### Step 2: åˆ›å»ºEmbeddingæœåŠ¡

#### 2.1 æœåŠ¡è®¾è®¡æ€è·¯
```python
# services/embedding_service.py æ ¸å¿ƒç»“æ„
class EmbeddingService:
    def __init__(self, api_key, model="text-embedding-3-small"):
        """åˆå§‹åŒ–embeddingæœåŠ¡"""
        pass
    
    def embed_text(self, text: str) -> List[float]:
        """å•ä¸ªæ–‡æœ¬å‘é‡åŒ–"""
        pass
    
    def embed_batch(self, texts: List[str]) -> List[List[float]]:
        """æ‰¹é‡æ–‡æœ¬å‘é‡åŒ–ï¼ˆæé«˜æ•ˆç‡ï¼‰"""
        pass
    
    def cosine_similarity(self, vec1, vec2) -> float:
        """è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦"""
        pass
```

#### 2.2 å®ç°è¦ç‚¹
- **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œå¼‚å¸¸ã€APIé™æµã€æ— æ•ˆè¾“å…¥ç­‰
- **é‡è¯•æœºåˆ¶**ï¼šæŒ‡æ•°é€€é¿ç­–ç•¥ï¼Œæœ€å¤§é‡è¯•æ¬¡æ•°
- **æ‰¹é‡å¤„ç†**ï¼šæé«˜APIè°ƒç”¨æ•ˆç‡ï¼Œé™ä½æˆæœ¬
- **ç¼“å­˜æœºåˆ¶**ï¼šé¿å…é‡å¤è®¡ç®—ç›¸åŒæ–‡æœ¬çš„å‘é‡

#### 2.3 æµ‹è¯•éªŒè¯
```python
# ç®€å•æµ‹è¯•ä»£ç 
embedding_service = EmbeddingService()
vector = embedding_service.embed_text("æµ‹è¯•æ–‡æœ¬")
print(f"å‘é‡ç»´åº¦: {len(vector)}")  # åº”è¯¥è¾“å‡º1536
```

### Step 3: å®ç°å‘é‡å­˜å‚¨

#### 3.1 FAISSåŸºç¡€æ¦‚å¿µ
- **Indexï¼ˆç´¢å¼•ï¼‰**ï¼šå­˜å‚¨å‘é‡çš„æ•°æ®ç»“æ„
- **IndexFlatL2**ï¼šæš´åŠ›æœç´¢ï¼Œç²¾ç¡®ä½†æ…¢
- **IndexIVFFlat**ï¼šå€’æ’ç´¢å¼•ï¼Œå¿«é€Ÿä½†è¿‘ä¼¼
- **IndexHNSW**ï¼šåˆ†å±‚å›¾ç´¢å¼•ï¼Œå¹³è¡¡é€Ÿåº¦å’Œç²¾åº¦

#### 3.2 æœåŠ¡å®ç°ç»“æ„
```python
# services/vector_store_service.py æ ¸å¿ƒç»“æ„
class VectorStoreService:
    def __init__(self, dimension=1536):
        """åˆå§‹åŒ–å‘é‡å­˜å‚¨æœåŠ¡"""
        self.dimension = dimension
        self.index = None
        self.documents = []  # å­˜å‚¨åŸå§‹æ–‡æ¡£
    
    def add_documents(self, documents, vectors):
        """æ·»åŠ æ–‡æ¡£å’Œå¯¹åº”å‘é‡"""
        pass
    
    def search_similar(self, query_vector, k=5):
        """ç›¸ä¼¼åº¦æœç´¢"""
        pass
    
    def save_index(self, path):
        """ä¿å­˜ç´¢å¼•åˆ°ç£ç›˜"""
        pass
    
    def load_index(self, path):
        """ä»ç£ç›˜åŠ è½½ç´¢å¼•"""
        pass
```

#### 3.3 å®ç°ç»†èŠ‚

**æ·»åŠ æ–‡æ¡£ç¤ºä¾‹ï¼š**
```python
# æ–‡æ¡£å‡†å¤‡
documents = [
    "è‹¹æœæ˜¯ä¸€ç§æ°´æœï¼Œå‘³é“å¾ˆç”œã€‚",
    "é¦™è•‰å¯Œå«é’¾å…ƒç´ ï¼Œå¯¹å¥åº·æœ‰ç›Šã€‚",
    "æ©™å­å«æœ‰ä¸°å¯Œçš„ç»´ç”Ÿç´ Cã€‚"
]

# å‘é‡åŒ–
vectors = [embedding_service.embed_text(doc) for doc in documents]

# å­˜å‚¨åˆ°FAISS
vector_store.add_documents(documents, vectors)
```

**æœç´¢ç¤ºä¾‹ï¼š**
```python
# ç”¨æˆ·æŸ¥è¯¢
query = "ä»€ä¹ˆæ°´æœæ¯”è¾ƒç”œï¼Ÿ"
query_vector = embedding_service.embed_text(query)

# æœç´¢ç›¸ä¼¼æ–‡æ¡£
results = vector_store.search_similar(query_vector, k=3)
for doc, score in results:
    print(f"ç›¸ä¼¼åº¦: {score:.3f}, æ–‡æ¡£: {doc}")
```

### Step 4: æ„å»ºé—®ç­”ç³»ç»Ÿ

#### 4.1 ç³»ç»Ÿé›†æˆæ¶æ„
```python
# services/qa_system.py æ ¸å¿ƒç»“æ„
class QASystem:
    def __init__(self, embedding_service, vector_store, llm_service):
        """åˆå§‹åŒ–é—®ç­”ç³»ç»Ÿ"""
        self.embedding_service = embedding_service
        self.vector_store = vector_store
        self.llm_service = llm_service
    
    def add_knowledge(self, documents):
        """æ·»åŠ çŸ¥è¯†åº“æ–‡æ¡£"""
        pass
    
    def answer_question(self, question, k=3):
        """å›ç­”é—®é¢˜"""
        # 1. é—®é¢˜å‘é‡åŒ–
        # 2. æ£€ç´¢ç›¸å…³æ–‡æ¡£
        # 3. æ„å»ºprompt
        # 4. è°ƒç”¨LLMç”Ÿæˆç­”æ¡ˆ
        pass
```

#### 4.2 Promptå·¥ç¨‹
```python
# æ„å»ºé«˜è´¨é‡çš„prompt
def build_qa_prompt(question, context_docs):
    context = "\n".join([f"æ–‡æ¡£{i+1}: {doc}" for i, doc in enumerate(context_docs)])
    
    prompt = f"""
åŸºäºä»¥ä¸‹æ–‡æ¡£å†…å®¹å›ç­”é—®é¢˜ï¼Œå¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·è¯´æ˜æ— æ³•å›ç­”ã€‚

ç›¸å…³æ–‡æ¡£ï¼š
{context}

é—®é¢˜ï¼š{question}

è¯·æä¾›å‡†ç¡®ã€ç®€æ´çš„ç­”æ¡ˆï¼š
"""
    return prompt
```

#### 4.3 FastAPIæ¥å£å®ç°
```python
# api/vector_qa.py
from fastapi import APIRouter

router = APIRouter()

@router.post("/qa/ask")
async def ask_question(request: QuestionRequest):
    """é—®ç­”æ¥å£"""
    try:
        answer = qa_system.answer_question(request.question)
        return {"answer": answer, "status": "success"}
    except Exception as e:
        return {"error": str(e), "status": "error"}

@router.post("/qa/add_knowledge")
async def add_knowledge(request: KnowledgeRequest):
    """æ·»åŠ çŸ¥è¯†åº“"""
    qa_system.add_knowledge(request.documents)
    return {"message": "çŸ¥è¯†åº“æ›´æ–°æˆåŠŸ", "status": "success"}
```

### Step 5: æµ‹è¯•ä¸ä¼˜åŒ–

#### 5.1 å•å…ƒæµ‹è¯•ç¼–å†™
```python
# tests/test_day6_vector_db.py
import pytest

class TestEmbeddingService:
    def test_embed_text(self):
        """æµ‹è¯•æ–‡æœ¬å‘é‡åŒ–"""
        service = EmbeddingService()
        vector = service.embed_text("æµ‹è¯•æ–‡æœ¬")
        assert len(vector) == 1536
        assert all(isinstance(x, float) for x in vector)
    
    def test_cosine_similarity(self):
        """æµ‹è¯•ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—"""
        service = EmbeddingService()
        vec1 = service.embed_text("è‹¹æœå¾ˆç”œ")
        vec2 = service.embed_text("æ°´æœå‘³é“å¥½")
        similarity = service.cosine_similarity(vec1, vec2)
        assert 0 <= similarity <= 1

class TestVectorStoreService:
    def test_add_and_search(self):
        """æµ‹è¯•æ·»åŠ æ–‡æ¡£å’Œæœç´¢"""
        # æµ‹è¯•å®ç°...
        pass
```

#### 5.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**1. æ‰¹é‡å¤„ç†ä¼˜åŒ–**
```python
# æ‰¹é‡å‘é‡åŒ–ï¼Œå‡å°‘APIè°ƒç”¨
def batch_embed_with_progress(texts, batch_size=100):
    results = []
    for i in range(0, len(texts), batch_size):
        batch = texts[i:i+batch_size]
        batch_vectors = embedding_service.embed_batch(batch)
        results.extend(batch_vectors)
        print(f"å¤„ç†è¿›åº¦: {i+len(batch)}/{len(texts)}")
    return results
```

**2. ç´¢å¼•ä¼˜åŒ–**
```python
# æ ¹æ®æ•°æ®é‡é€‰æ‹©åˆé€‚çš„ç´¢å¼•ç±»å‹
def create_optimized_index(dimension, num_docs):
    if num_docs < 1000:
        # å°æ•°æ®é‡ï¼Œä½¿ç”¨ç²¾ç¡®æœç´¢
        return faiss.IndexFlatL2(dimension)
    elif num_docs < 100000:
        # ä¸­ç­‰æ•°æ®é‡ï¼Œä½¿ç”¨IVFç´¢å¼•
        quantizer = faiss.IndexFlatL2(dimension)
        return faiss.IndexIVFFlat(quantizer, dimension, 100)
    else:
        # å¤§æ•°æ®é‡ï¼Œä½¿ç”¨HNSWç´¢å¼•
        return faiss.IndexHNSWFlat(dimension, 32)
```

#### 5.3 å‡†ç¡®ç‡è¯„ä¼°
```python
# è¯„ä¼°é—®ç­”ç³»ç»Ÿå‡†ç¡®ç‡
def evaluate_qa_system(test_questions, expected_answers):
    correct = 0
    total = len(test_questions)
    
    for question, expected in zip(test_questions, expected_answers):
        answer = qa_system.answer_question(question)
        # ä½¿ç”¨è¯­ä¹‰ç›¸ä¼¼åº¦è¯„ä¼°ç­”æ¡ˆè´¨é‡
        similarity = calculate_semantic_similarity(answer, expected)
        if similarity > 0.8:  # é˜ˆå€¼å¯è°ƒ
            correct += 1
    
    accuracy = correct / total
    print(f"é—®ç­”å‡†ç¡®ç‡: {accuracy:.2%}")
    return accuracy
```

## ğŸ“ å­¦ä¹ æˆæœæ£€éªŒ

### ç†è®ºæŒæ¡æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š

**åŸºç¡€æ¦‚å¿µï¼ˆå¿…é¡»æŒæ¡ï¼‰**
- [ ] ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®åº“ï¼Ÿä¸ä¼ ç»Ÿæ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
- [ ] Embeddingçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Ÿ
- [ ] ä½™å¼¦ç›¸ä¼¼åº¦æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿä¸ºä»€ä¹ˆé€‚åˆæ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—ï¼Ÿ
- [ ] Top-Kæ£€ç´¢ä¸­çš„Kå€¼å¦‚ä½•é€‰æ‹©ï¼Ÿè¿‡å¤§æˆ–è¿‡å°æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ

**æŠ€æœ¯å®ç°ï¼ˆæ ¸å¿ƒæŠ€èƒ½ï¼‰**
- [ ] å¦‚ä½•è°ƒç”¨OpenAI Embedding APIè·å–æ–‡æœ¬å‘é‡ï¼Ÿ
- [ ] FAISSç´¢å¼•çš„åˆ›å»ºã€ä¿å­˜å’ŒåŠ è½½æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ
- [ ] å¦‚ä½•å®ç°æ–‡æ¡£çš„æ‰¹é‡å‘é‡åŒ–å’Œå­˜å‚¨ï¼Ÿ
- [ ] é—®ç­”ç³»ç»Ÿçš„å®Œæ•´æµç¨‹åŒ…æ‹¬å“ªäº›æ­¥éª¤ï¼Ÿ

**å®è·µåº”ç”¨ï¼ˆè¿›é˜¶èƒ½åŠ›ï¼‰**
- [ ] å¦‚ä½•ä¼˜åŒ–å‘é‡æœç´¢çš„æ€§èƒ½ï¼Ÿ
- [ ] å¦‚ä½•è¯„ä¼°é—®ç­”ç³»ç»Ÿçš„å‡†ç¡®ç‡ï¼Ÿ
- [ ] é‡åˆ°APIé™æµæˆ–ç½‘ç»œé”™è¯¯å¦‚ä½•å¤„ç†ï¼Ÿ
- [ ] å¦‚ä½•è®¾è®¡åˆé€‚çš„æ–‡æ¡£åˆ†å—ç­–ç•¥ï¼Ÿ

### å®é™…æŠ€èƒ½éªŒè¯

**ä½ å°†èƒ½å¤Ÿç‹¬ç«‹å®Œæˆï¼š**
- âœ… ä½¿ç”¨OpenAI Embedding APIè¿›è¡Œæ–‡æœ¬å‘é‡åŒ–
- âœ… æ„å»ºå’Œç®¡ç†FAISSå‘é‡ç´¢å¼•
- âœ… å®ç°åŸºäºè¯­ä¹‰çš„æ–‡æ¡£æ£€ç´¢åŠŸèƒ½
- âœ… é›†æˆLangChainç»„ä»¶æ„å»ºRAGç³»ç»Ÿ
- âœ… å¼€å‘å®Œæ•´çš„é—®ç­”APIæœåŠ¡
- âœ… ç¼–å†™æµ‹è¯•ç”¨ä¾‹éªŒè¯ç³»ç»ŸåŠŸèƒ½
- âœ… ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½å’Œå‡†ç¡®ç‡

### é¡¹ç›®ä½œå“å±•ç¤º

å­¦ä¹ å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ï¼š
1. **å®Œæ•´çš„å‘é‡æ•°æ®åº“æœåŠ¡** - æ”¯æŒæ–‡æ¡£å­˜å‚¨ã€æ£€ç´¢å’Œç®¡ç†
2. **æ™ºèƒ½é—®ç­”ç³»ç»Ÿ** - åŸºäºè¯­ä¹‰æ£€ç´¢çš„AIé—®ç­”æœåŠ¡
3. **RESTful APIæ¥å£** - å¯ç›´æ¥éƒ¨ç½²çš„WebæœåŠ¡
4. **å®Œå–„çš„æµ‹è¯•å¥—ä»¶** - ä¿è¯ä»£ç è´¨é‡å’ŒåŠŸèƒ½æ­£ç¡®æ€§
5. **æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ** - é€‚åº”ä¸åŒè§„æ¨¡çš„åº”ç”¨åœºæ™¯

## ğŸ“š å­¦ä¹ èµ„æºä¸å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [OpenAI Embedding APIæ–‡æ¡£](https://platform.openai.com/docs/guides/embeddings) - å®˜æ–¹APIä½¿ç”¨æŒ‡å—
- [FAISSå®˜æ–¹æ–‡æ¡£](https://faiss.ai/) - Facebook AIç›¸ä¼¼æ€§æœç´¢åº“
- [LangChainå‘é‡å­˜å‚¨æŒ‡å—](https://python.langchain.com/docs/modules/data_connection/vectorstores/) - å‘é‡å­˜å‚¨é›†æˆæ–¹æ¡ˆ
- [ChromaDBå¿«é€Ÿå¼€å§‹](https://docs.trychroma.com/getting-started) - è½»é‡çº§å‘é‡æ•°æ®åº“

### å¸¸è§é—®é¢˜è§£ç­”

**Q1: ä¸ºä»€ä¹ˆé€‰æ‹©FAISSè€Œä¸æ˜¯å…¶ä»–å‘é‡æ•°æ®åº“ï¼Ÿ**
A: FAISSé€‚åˆå­¦ä¹ å’ŒåŸå‹å¼€å‘ï¼Œå…è´¹å¼€æºï¼Œæ€§èƒ½ä¼˜ç§€ã€‚ç”Ÿäº§ç¯å¢ƒå¯è€ƒè™‘Pineconeã€Weaviateç­‰æ‰˜ç®¡æœåŠ¡ã€‚

**Q2: Embeddingæ¨¡å‹å¦‚ä½•é€‰æ‹©ï¼Ÿ**
A: å¼€å‘é˜¶æ®µæ¨è`text-embedding-3-small`ï¼Œæˆæœ¬ä½æ•ˆæœå¥½ã€‚ç”Ÿäº§ç¯å¢ƒå¯å‡çº§åˆ°`text-embedding-3-large`ã€‚

**Q3: å‘é‡ç»´åº¦è¶Šé«˜è¶Šå¥½å—ï¼Ÿ**
A: ä¸ä¸€å®šã€‚é«˜ç»´åº¦æä¾›æ›´å¤šä¿¡æ¯ä½†å¢åŠ è®¡ç®—æˆæœ¬ã€‚1536ç»´é€šå¸¸æ˜¯æ€§èƒ½å’Œæˆæœ¬çš„è‰¯å¥½å¹³è¡¡ç‚¹ã€‚

**Q4: å¦‚ä½•å¤„ç†ä¸­æ–‡æ–‡æœ¬ï¼Ÿ**
A: OpenAIçš„embeddingæ¨¡å‹å¤©ç„¶æ”¯æŒä¸­æ–‡ï¼Œæ— éœ€ç‰¹æ®Šå¤„ç†ã€‚æ³¨æ„æ–‡æœ¬é¢„å¤„ç†ï¼ˆå»é™¤ç‰¹æ®Šå­—ç¬¦ã€ç»Ÿä¸€ç¼–ç ï¼‰ã€‚

**Q5: å‘é‡æœç´¢ç»“æœä¸å‡†ç¡®æ€ä¹ˆåŠï¼Ÿ**
A: æ£€æŸ¥æ–‡æ¡£åˆ†å—ç­–ç•¥ã€è°ƒæ•´æ£€ç´¢å‚æ•°Kå€¼ã€ä¼˜åŒ–promptè®¾è®¡ã€è€ƒè™‘ä½¿ç”¨é‡æ’åºæ¨¡å‹ã€‚

### è¿›é˜¶å­¦ä¹ æ–¹å‘
**ç«‹å³å¯å­¦ä¹ ï¼š**
- **Day 7**ï¼šRAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰é«˜çº§å®ç°
  - æ–‡æ¡£åˆ†å—ç­–ç•¥ä¼˜åŒ–
  - æ··åˆæ£€ç´¢ï¼ˆå…³é”®è¯+è¯­ä¹‰ï¼‰
  - ç»“æœé‡æ’åºå’Œè¿‡æ»¤

**åç»­æ·±å…¥ï¼š**
- **Day 8**ï¼šå¤šè½®å¯¹è¯ä¸è®°å¿†æ¨¡å—
  - å¯¹è¯å†å²ç®¡ç†
  - ä¸Šä¸‹æ–‡æ„ŸçŸ¥æ£€ç´¢
  - ä¸ªæ€§åŒ–æ¨è

**æ‰©å±•æ–¹å‘ï¼š**
- **å‘é‡æ•°æ®åº“è¿›é˜¶**ï¼šå­¦ä¹ Pineconeã€Weaviateç­‰äº‘æœåŠ¡
- **Embeddingä¼˜åŒ–**ï¼šå¾®è°ƒembeddingæ¨¡å‹ï¼Œæå‡é¢†åŸŸé€‚åº”æ€§
- **ç³»ç»Ÿæ¶æ„**ï¼šåˆ†å¸ƒå¼å‘é‡æœç´¢ï¼Œé«˜å¹¶å‘å¤„ç†
